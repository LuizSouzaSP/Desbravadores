<!DOCTYPE html>
<html lang="pt-br"> 

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conta | Aventura</title>

    
    <link rel="stylesheet" href="styles/conta.css" />
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="js/dadosQuiz.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <!-- <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script> -->
</head>

<!-- <body onload=" atualizarFeed()"> -->

<body>
    <div class="header">
        <div class="conteiner">
                <ul class="nav-bar">
                    <li>
                        <div class="box">
                            <a href="dashboard.html">inicio</a>
                        </div>
                    </li>
                    <li>
                        <div class="box1">
                            <a href="quiz.html">Quiz</a>
                        </div>
                    </li>
                    <li>
                        <div class="box2">
                            <a href="#">Conta</a>
                        </div>
                    </li>
                </ul>
                <div class="usuario">
                    <div class="hello">
                        <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                    </div>
                    <div class="dash">
                        <div class="btns-dash" id="btnAquario">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
    </div>
    </div>


</body>

</html>

<script>
    Questionario;

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO


    let proximaAtualizacao;

    obterDadosGrafico(sessionStorage.ID_USUARIO);
function obterDadosGrafico(idusuario) {

// alterarTitulo(idQuestionario)

if (proximaAtualizacao != undefined) {
    clearTimeout(proximaAtualizacao);
}
fetch(`/medidas/resultado/${idusuario}`, {
    method: 'GET',
    headers: {
        "Content-Type": "application/json"
    },   
}).then(function (response) {
    if (response.ok) {
        response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            console.log(resposta[0].Certas)
            console.log(resposta[0].Erradas)
            

            plotarGrafico(resposta);
            
        });
    } else {
        console.error('Nenhum dado encontrado ou erro na API');
    }
})
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}
function plotarGrafico(resultado) {

console.log('iniciando plotagem do gráfico...');

// Criando estrutura para plotar gráfico - labels
const idusuairo = sessionStorage.getItem('ID_USUARIO');
const dados = [resultado[0].Certas, resultado[0].Erradas]


// Criando estrutura para plotar gráfico - dados
const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Certas', 'Erradas'],
      datasets: [{
        label: 'Questionario 1',
        data: dados,
        borderWidth: 1,
        backgroundColor: ['green', 'red']
      }
    ]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

console.log('----------------------------------------------')
console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
console.log(resposta[0])

// Inserindo valores recebidos em estrutura para plotar o gráfico

console.log('----------------------------------------------')
console.log('O gráfico será plotado com os respectivos valores:')
console.log('Labels:')
console.log(labels)
console.log('Dados:')
console.log(dados.datasets)
console.log('----------------------------------------------')

// Criando estrutura para plotar gráfico - config


// Adicionando gráfico criado em div na tela
}
</script>