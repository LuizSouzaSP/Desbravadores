<!DOCTYPE html>
<html lang="pt-br"> 

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conta | Aventura</title>

    
    <link rel="stylesheet" href="styles/conta.css" />
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="js/dadosQuiz.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <!-- <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script> -->
</head>

<!-- <body onload=" atualizarFeed()"> -->

<body>
    <div class="header">
        <div class="conteiner">
                <ul class="nav-bar">
                    <li>
                        <div class="box">
                            <a href="#">inicio</a>
                        </div>
                    </li>
                    <li>
                        <div class="box1">
                            <a href="quiz.html">Quiz</a>
                        </div>
                    </li>
                    <li>
                        <div class="box2">
                            <a href="#">Conta</a>
                        </div>
                    </li>
                </ul>
                <div class="usuario">
                    <div class="hello">
                        <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                    </div>
                    <div class="dash">
                        <div class="btns-dash" id="btnAquario">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
    </div>
    </div>


</body>

</html>

<script>
    // let id = [];
    // let usuario = [];
    // let questionario = [];
    Questionario;

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var pontuacao = sessionStorage.RESULTADO;

    let proximaAtualizacao;
function obterDadosGrafico(resultado) {

alterarTitulo(idQuestionario)

if (proximaAtualizacao != undefined) {
    clearTimeout(proximaAtualizacao);
}
// fetch(`http://localhost:3333/medidas/resultado?idusuario=${sessionStorage.getItem('ID_USUARIO')}`)
//   .then(response => response.json())
//   .then(data => {
//     plotarGrafico(data);
//   })
//   .catch(err => {
//     console.log(err);
//   });
fetch(`http://localhost:3333/medidas/resultado`, {
    method: 'GET',
    headers: {
        "Content-Type": "application/json"
    },   
}).then(function (response) {
    if (response.ok) {
        response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            console.log(resposta)

            plotarGrafico(resposta, resultado);
        });
    } else {
        console.error('Nenhum dado encontrado ou erro na API');
    }
})
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
    
// fetch(`/medidas/resultado`, { cache: 'no-store' }).then(function (response) {
//     if (response.ok) {
//         response.json().then(function (resposta) {
//             console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
//             resposta.reverse();
//             console.log(resposta)

//             plotarGrafico(resposta, resultado);
//         });
//     } else {
//         console.error('Nenhum dado encontrado ou erro na API');
//     }
// })
//     .catch(function (error) {
//         console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
//     });
}
function plotarGrafico(resultado) {

console.log('iniciando plotagem do gráfico...');

// Criando estrutura para plotar gráfico - labels
const idusuairo = sessionStorage.getItem('ID_USUARIO');
const dados = []


// Criando estrutura para plotar gráfico - dados
const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Certas', 'Erradas'],
      datasets: [{
        label: 'Questionario 1',
        data: dados,
        borderWidth: 1,
        backgroundColor: ['green', 'red']
      }
    ]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

console.log('----------------------------------------------')
console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
console.log(resposta)

// Inserindo valores recebidos em estrutura para plotar o gráfico

console.log('----------------------------------------------')
console.log('O gráfico será plotado com os respectivos valores:')
console.log('Labels:')
console.log(labels)
console.log('Dados:')
console.log(dados.datasets)
console.log('----------------------------------------------')

// Criando estrutura para plotar gráfico - config


// Adicionando gráfico criado em div na tela


// setTimeout(() => atualizarGrafico(idQuestionario, dados, myChart), 2000);
}

    // function atualizarGrafico(idQuestoes, dados, myChart) {



    //     fetch(`/questoes/:${idQuestoes}`, { cache: 'no-store' }).then(function (response) {
    //         if (response.ok) {
    //             response.json().then(function (novoRegistro) {

    //                 obterdados(idQuestoes);
    //                 // alertar(novoRegistro, idAquario);
    //                 console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
    //                 console.log(`Dados atuais do gráfico:`);
    //                 console.log(dados);

    //                 let avisoCaptura = document.getElementById(`avisoCaptura${idAquario}`)
    //                 avisoCaptura.innerHTML = ""


    //                 if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
    //                     console.log("---------------------------------------------------------------")
    //                     console.log("Como não há dados novos para captura, o gráfico não atualizará.")
    //                     avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
    //                     console.log("Horário do novo dado capturado:")
    //                     console.log(novoRegistro[0].momento_grafico)
    //                     console.log("Horário do último dado capturado:")
    //                     console.log(dados.labels[dados.labels.length - 1])
    //                     console.log("---------------------------------------------------------------")
    //                 } else {
    //                     // tirando e colocando valores no gráfico
    //                     dados.labels.shift(); // apagar o primeiro
    //                     dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

    //                     dados.datasets[0].data.shift();  // apagar o primeiro de umidade
    //                     dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

    //                     dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
    //                     dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

    //                     myChart.update();
    //                 }

    //                 // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
    //                 proximaAtualizacao = setTimeout(() => atualizarGrafico(idQuestoes, dados, myChart), 2000);
    //             });
    //         } else {
    //             console.error('Nenhum dado encontrado ou erro na API');
    //             // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
    //             proximaAtualizacao = setTimeout(() => atualizarGrafico(idQuestoes, dados, myChart), 2000);
    //         }
    //     })
    //         .catch(function (error) {
    //             console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //         });

    // }
</script>